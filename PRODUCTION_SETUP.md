# –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–∏—Å—Ç–µ–º—ã "–ê–ø–µ–ª—å—Å–∏–Ω" –Ω–∞ VDS

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Ubuntu 20.04 LTS –∏–ª–∏ –Ω–æ–≤–µ–µ
- –ú–∏–Ω–∏–º—É–º 2GB RAM
- 20GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- –î–æ—Å—Ç—É–ø root –∏–ª–∏ sudo

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
\`\`\`bash
sudo apt update && sudo apt upgrade -y
sudo apt install curl wget git unzip -y
\`\`\`

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose

\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.21.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
sudo reboot
\`\`\`

## 3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

\`\`\`bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /opt/apelsin
sudo chown $USER:$USER /opt/apelsin
cd /opt/apelsin

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
git clone https://github.com/your-username/apelsin-delivery.git .

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
nano .env
\`\`\`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞
\`\`\`env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL="postgresql://apelsin_user:ApelsinDelivery2024!@db:5432/apelsin_db"

# JWT —Å–µ–∫—Ä–µ—Ç (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
JWT_SECRET="–≤–∞—à-—É–Ω–∏–∫–∞–ª—å–Ω—ã–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-–¥–ª–∏–Ω–æ–π-–º–∏–Ω–∏–º—É–º-32-—Å–∏–º–≤–æ–ª–∞"

# FTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
FTP_HOST="ftp"
FTP_PORT="21"
FTP_USER="apelsin_ftp"
FTP_PASSWORD="–Ω–∞–¥–µ–∂–Ω—ã–π-–ø–∞—Ä–æ–ª—å-–¥–ª—è-ftp"
FTP_DIRECTORY="/xml_uploads"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
NODE_ENV="production"
NEXT_PUBLIC_APP_URL="https://–≤–∞—à-–¥–æ–º–µ–Ω.com"
\`\`\`

## 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
\`\`\`bash
mkdir -p ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout ssl/key.pem \
  -out ssl/cert.pem \
  -subj "/C=KZ/ST=Almaty/L=Almaty/O=Apelsin/CN=–≤–∞—à-–¥–æ–º–µ–Ω.com"
\`\`\`

### –ò–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
\`\`\`bash
sudo apt install certbot -y
sudo certbot certonly --standalone -d –≤–∞—à-–¥–æ–º–µ–Ω.com
sudo cp /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.com/fullchain.pem ssl/cert.pem
sudo cp /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.com/privkey.pem ssl/key.pem
sudo chown $USER:$USER ssl/*
\`\`\`

## 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

\`\`\`bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f app
\`\`\`

## 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

\`\`\`bash
sudo ufw allow 22      # SSH
sudo ufw allow 80      # HTTP
sudo ufw allow 443     # HTTPS
sudo ufw allow 21      # FTP
sudo ufw allow 30000:30009/tcp  # FTP –ø–∞—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
sudo ufw enable
\`\`\`

## 7. –°–æ–∑–¥–∞–Ω–∏–µ FTP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ XML

FTP —Å–µ—Ä–≤–µ—Ä —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Docker Compose. –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- **–•–æ—Å—Ç**: IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- **–ü–æ—Ä—Ç**: 21
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: apelsin_ftp
- **–ü–∞—Ä–æ–ª—å**: —Ç–æ—Ç —á—Ç–æ —É–∫–∞–∑–∞–ª–∏ –≤ .env —Ñ–∞–π–ª–µ
- **–ü–∞–ø–∫–∞ –¥–ª—è XML**: /xml_uploads

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FTP –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
sudo apt install ftp -y

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ FTP
ftp localhost
# –í–≤–µ–¥–∏—Ç–µ: apelsin_ftp –∏ –ø–∞—Ä–æ–ª—å
# –ö–æ–º–∞–Ω–¥—ã: ls, cd xml_uploads, put —Ñ–∞–π–ª.xml, quit
\`\`\`

## 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

\`\`\`bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
sudo nano /opt/apelsin/backup.sh
\`\`\`

\`\`\`bash
#!/bin/bash
BACKUP_DIR="/opt/apelsin/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec -T db pg_dump -U apelsin_user apelsin_db > $BACKUP_DIR/db_backup_$DATE.sql

# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
docker-compose exec -T ftp tar -czf - /home/apelsin_ftp > $BACKUP_DIR/ftp_backup_$DATE.tar.gz

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: $DATE"
\`\`\`

\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
chmod +x /opt/apelsin/backup.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00)
sudo crontab -e
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
0 2 * * * /opt/apelsin/backup.sh >> /var/log/apelsin-backup.log 2>&1
\`\`\`

## 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

\`\`\`bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs -f app

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs -f db

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ FTP
docker-compose logs -f ftp

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
df -h
\`\`\`

## 10. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

\`\`\`bash
cd /opt/apelsin

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose down

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
\`\`\`

## 11. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –∏ DNS

1. –î–æ–±–∞–≤—å—Ç–µ A-–∑–∞–ø–∏—Å—å –≤ DNS –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞, —É–∫–∞–∑—ã–≤–∞—é—â—É—é –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞
2. –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (–¥–æ 24 —á–∞—Å–æ–≤)
3. –û–±–Ω–æ–≤–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞

## 12. –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://–≤–∞—à-–¥–æ–º–µ–Ω.com
2. –í–æ–π–¥–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—è —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
   - **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**: admin@apelsin.kz / admin123
   - **–ú–µ–Ω–µ–¥–∂–µ—Ä**: manager@apelsin.kz / manager123

## 13. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ FTP –¥–ª—è 1–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ 1–°:
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö 1–° —É–∫–∞–∂–∏—Ç–µ:
   - **FTP —Å–µ—Ä–≤–µ—Ä**: IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   - **–ü–æ—Ä—Ç**: 21
   - **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: apelsin_ftp
   - **–ü–∞—Ä–æ–ª—å**: –∏–∑ .env —Ñ–∞–π–ª–∞
   - **–ü–∞–ø–∫–∞**: /xml_uploads

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤—ã–≥—Ä—É–∑–∫—É XML –∫–∞–∂–¥—ã–µ 5-10 –º–∏–Ω—É—Ç

## 14. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
\`\`\`bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ë–î
docker-compose logs db

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec db psql -U apelsin_user -d apelsin_db
\`\`\`

### –ü—Ä–æ–±–ª–µ–º—ã —Å FTP
\`\`\`bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ FTP —Å–µ—Ä–≤–µ—Ä–∞
docker-compose logs ftp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep :21
\`\`\`

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL
\`\`\`bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl x509 -in ssl/cert.pem -text -noout

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ Let's Encrypt
sudo certbot renew
\`\`\`

## 15. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
1. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ fail2ban (–∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞)
\`\`\`bash
sudo apt install fail2ban -y
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
\`\`\`

## 16. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL
\`\`\`bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose exec db nano /var/lib/postgresql/data/postgresql.conf

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è 2GB RAM:
# shared_buffers = 512MB
# effective_cache_size = 1536MB
# maintenance_work_mem = 128MB
# checkpoint_completion_target = 0.9
# wal_buffers = 16MB
\`\`\`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
\`\`\`bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ htop –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sudo apt install htop -y

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
htop
\`\`\`

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `docker-compose ps`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ: `df -h`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å: `free -h`

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ! üöÄ
